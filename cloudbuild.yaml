timeout: "1200s" # A 20 minute timeout as this can take longer than the default 10 mins
steps:

# Pull the Cloud Build Helper, invoke setup to expose shorthand `cloud_build_helper``
- name: 'eu.gcr.io/registry-153916/cloud_build_helper'
  entrypoint: 'setup'
  id: "cloud-helper-setup"

- name: 'cloud_build_helper'
  entrypoint: 'build-with-cache' ## Always build the main image
  args: ['a24-ember-test-lib', 'Dockerfile']
  secretEnv: ['PRIVATE_SSH_KEY']
  env: [ 'NAMESPACE=a24-ember-test-lib' ]
  waitFor: ["cloud-helper-setup"]

# Run the tests
- name: 'cloud_build_helper'
  entrypoint: 'image-bash-cmd'
  args: ['a24-ember-test-lib', '"source /etc/profile && cd testPrep && ls -lah && node templatePrepare.js && cd .. && node_modules/.bin/ember test"']

# Trigger the rest of the build chain
- name: 'eu.gcr.io/registry-153916/cloud_build_helper_gcloud'
  entrypoint: 'ui-chain'
  args: ['${_BUILD_QUEUE}']
  secretEnv: ['UI_TRIGGER_KEY']

# Secrets
secrets:
- kmsKeyName: projects/registry-153916/locations/global/keyRings/buildargs/cryptoKeys/githhubsshkey
  secretEnv:
    PRIVATE_SSH_KEY: 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
- kmsKeyName: projects/registry-153916/locations/global/keyRings/buildargs/cryptoKeys/ui-trigger-key
  secretEnv:
    UI_TRIGGER_KEY: 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